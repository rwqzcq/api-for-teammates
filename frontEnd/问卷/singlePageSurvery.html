<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="Author" content="Taoist">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <title>华师问卷</title>
    <style>
        *{ margin: 0; padding: 0; font-family:Microsoft yahei,serif;}
        li{ list-style-type:none;}
        a{color:#000;text-decoration:none;}
    </style>
    <link href="https://cdn.bootcss.com/bootstrap/4.0.0-beta.2/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.bootcss.com/bootstrap/4.0.0-beta.2/js/bootstrap.min.js"></script>
    <link href="./css/common.css" rel="stylesheet">
    <link rel="stylesheet" href="./css/jquery-labelauty.css">
    <script src="./js/jquery-1.8.3.min.js"></script>
    <script src="./js/jquery-labelauty.js"></script>
    <script src="./js/index.js"></script>
</head>
<body>
    <h2 class="Btitle">停水停电学校大调查</h2>
    <!--进度条-->
    <div class="progressBar">
        <div class="barContainer">
            <div class="bar"></div>
        </div>
    </div>
    <div class="container-fluid Box" id="ContentBox">
        <ul class="content list-group">
            <li class="list-group-item Radio">
                <p class="list-group-item-heading"><span class="Cindex">1</span><span>. </span>这是一个单选题<em class="isMust">*</em></p>
                <!-- id动态生成，格式为Cindex-type-选项序列 || 每个input标签的name属性为题目序号（必须一致）-->
                <ul class="answerBox ">
                    <li class="answer list-group-item-text">
                        <input type="radio" name="1" value="1" id="1-Radio-1" class="labelauty">
                        <label class="answerName" for="1-Radio-1">
                            <span class="labelauty-unchecked-image"></span>
                            <span class="labelauty-unchecked">A 123456</span>
                            <span class="labelauty-checked-image"></span>
                            <span class="labelauty-checked">A 123456</span>
                        </label>
                    </li>
                    <li class="answer list-group-item-text">
                        <input type="radio" name="1" value="2" id="1-Radio-2" class="labelauty">
                        <label class="answerName" for="1-Radio-2">
                            <span class="labelauty-unchecked-image"></span>
                            <span class="labelauty-unchecked">B 123456</span>
                            <span class="labelauty-checked-image"></span>
                            <span class="labelauty-checked">B 123456</span>
                        </label>
                    </li>
                    <li class="answer list-group-item-text">
                        <input type="radio" name="1" value="3" id="1-Radio-3" class="labelauty">
                        <label class="answerName" for="1-Radio-3">
                            <span class="labelauty-unchecked-image"></span>
                            <span class="labelauty-unchecked">C 123456</span>
                            <span class="labelauty-checked-image"></span>
                            <span class="labelauty-checked">C 123456</span>
                        </label>
                    </li>
                </ul>
            </li>
            <li class="list-group-item button-holder">
                <!--.Cindex存放题号，动态生成-->
                <p class="list-group-item-heading"><span class="Cindex">2</span><span>. </span>这是一个多选题<em class="isMust">*</em></p>
                <ul class="answerBox Checkbox">
                    <!-- id动态生成，格式为Cindex-type-选项序列-->
                    <li class="answer list-group-item-text">
                        <input type="checkbox" name="2" value="1" id="2-Checkbox-1" class="labelauty">
                        <label class="answerName" for="2-Checkbox-1">
                            <span class="labelauty-unchecked-image"></span>
                            <span class="labelauty-unchecked">A 123456</span>
                            <span class="labelauty-checked-image"></span>
                            <span class="labelauty-checked">A 123456</span>
                        </label>
                    </li>
                    <li class="answer list-group-item-text">
                        <input type="checkbox" name="2" value="2" id="2-Checkbox-2" class="labelauty">
                        <label class="answerName" for="2-Checkbox-2">
                            <span class="labelauty-unchecked-image"></span>
                            <span class="labelauty-unchecked">B 123456</span>
                            <span class="labelauty-checked-image"></span>
                            <span class="labelauty-checked">B 123456</span>
                        </label>
                    </li>
                    <li class="answer list-group-item-text">
                        <input type="checkbox" name="2" value="3" id="2-Checkbox-3" class="labelauty">
                        <label class="answerName" for="2-Checkbox-3">
                            <span class="labelauty-unchecked-image"></span>
                            <span class="labelauty-unchecked">C 123456</span>
                            <span class="labelauty-checked-image"></span>
                            <span class="labelauty-checked">C 123456</span>
                        </label>
                    </li>
                </ul>
            </li>
            <li class="list-group-item TianKong">
                <p class="list-group-item-heading"><span class="Cindex">3</span><span>. </span>这是一个填空题<em class="isMust">*</em></p>
                <div class="answerBox">
                    <p class="answer list-group-item-text">您每月的花费是<input type="text" class="answerTianKong" name="o3">元。您觉得您应该得到<input type="text" class="answerTianKong" name="o3">元。</p>
                </div>
            </li>
            <li class="list-group-item XiaLa">
                <p class="list-group-item-heading"><span class="Cindex">4</span><span>. </span>这是一个下拉选框-您的年级是？<em class="isMust">*</em></p>
                <div class="answerBox">
                    <p class="answer list-group-item-text">
                        <select name="3" id="">
                            <option value="1">大一</option>
                            <option value="2">大二</option>
                            <option value="3">大三</option>
                            <option value="4">大四</option>
                        </select>
                    </p>
                </div>
            </li>
            <li class="list-group-item DanhangText">
                <p class="list-group-item-heading"><span class="Cindex">5</span><span>. </span>这是单行文本-你的个性签名是？<em class="isMust">*</em></p>
                <div class="answerBox">
                    <p class="answer list-group-item-text">
                        <input type="text" name="5" class="oneLine">
                    </p>
                </div>
            </li>
            <li class="list-group-item DuohangText">
                <p class="list-group-item-heading"><span class="Cindex">6</span><span>. </span>这是多行文本-你对这次问卷有什么建议或意见？<em class="isMust">*</em></p>
                <div class="answerBox">
                    <p class="answer list-group-item-text">
                        <textarea type="textarea" name="6" class="duoLine"></textarea>
                    </p>
                </div>
            </li>
        </ul>
    </div>
    <div class="submitBox">
        <button class="submit">提交</button>
    </div>
    <div class="alert">
        <span class="close">X</span>
        <h6 class="alertTit">！您有必填空未填写</h6>
        <hr>
        <p class="alertCon">请完成它们</p>
    </div>
    <script>
        var $oPbar = $(".progressBar"),
            $oBar = $(".bar");

        $(document).scroll(function (e) {
            e = window.event || e;
            if ($(document).scrollTop()>=40){
                $oPbar.addClass("on");
            }else {
                $oPbar.removeClass("on");
            }
        });


        //提交事件
        var $btn = $(".submit");
        var $alert = $(".alert");
        $btn.click(function () {
            var $oLi = $(".list-group-item-heading .isMust").parent().parent();
            var status = 0;//0为正常，1为有未填空
            var index=[];//存放空题题号0开始
            var indexI = 0;
            // 检测必填空
            for (var i = 0;i<$oLi.length;i++){
                var $oInput = ($oLi.eq(i).children(".answerBox").children(".answer").children("input").length === 0) ? $oLi.eq(i).children(".answerBox").children(".answer").children(".duoLine") : $oLi.eq(i).children(".answerBox").children(".answer").children("input") ;
                $oInput.attr("index",i);
                // console.log($oInput);
                switch ($oInput.attr("type")){
                    case "radio":
                        var $checked = $oInput.parent().children(".answerName").children(".labelauty-checked");
                        var stas = "none";
                        for (var j =0;j<$checked.length;j++){
                            stas = ((stas === "none") ? $checked.eq(j).css("display") : stas);
                        }
                        if (stas === "none"){
                            status = 1;
                            index[indexI] = $oInput.attr("index");
                            indexI++;
                        }
                        break;
                    case "checkbox":
                        var $checked = $oInput.parent().children(".answerName").children(".labelauty-checked");
                        var stas = "none";
                        for (var j =0;j<$checked.length;j++){
                            stas = ((stas === "none") ? $checked.eq(j).css("display") : stas);
                        }
                        if (stas === "none"){
                            status = 1;
                            index[indexI] = $oInput.attr("index");
                            indexI++;
                        }
                        break;
                    case "text":
                        for (var j = 0;j<$oInput.length;j++){
                            if (!$oInput.eq(j).val()){
                                status = 1;
                                index[indexI] = $oInput.attr("index");
                                indexI++;
                            }
                        }
                        break;
                    case "textarea":
                        if (!$oInput.eq(0).val()){
                            status = 1;
                            index[indexI] = $oInput.attr("index");
                            indexI++;
                        }
                        break;
                    default:
                        break;

                }
                // console.log($oInput.attr("type"))
            }
            console.log(status,index);
            //有未填空
            if (status === 1){
                $alert.show();
                var $con = $alert.children(".alertCon");
                for (var j =0 ;j<index.length;j++){
                    var elem = document.createElement("span");
                    elem.innerHTML = parseInt(index[j])+1+"题";
                    $con[0].appendChild(elem);
                }
                $alert.children(".close").click(function () {
                    $alert.css("display","none");
                })
            }else {//无未填空，可以提交

            }
        })
    </script>
</body>
</html>